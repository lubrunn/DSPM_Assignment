---
title: "Assignment V"
author: "Lukas Brunner"
date: "5 2 2021"
output: html_document
---

```{r setup, include=FALSE}
library(httr)
library(glue)
library(jsonlite)
library(rlist)
library(tidyverse)
source("key.R")
```

# Exercise 1
### Exercise 1.1
Perform a first GET request, that searches for event venues in Germany (countryCode = "DE"). Extract
the content from the response object and inspect the resulting list. Describe what you can see.

```{r 1}

resp_ven <- GET(glue("https://app.ticketmaster.com/discovery/v2/venues?apikey={key}&locale=*&countryCode=DE"))
con_ven <- fromJSON(content(resp_ven, as = "text"))
```
The resulting list contains three elements. The first contains the information of interest such as as the name and the location of the venues. The second element is the _links object and contains links to data sets. The last element is the page object. It contains information about the current page in the data source. 

### Exercise 1.2
Extract the name, the city, the postalCode and address, as well as the url and the longitude and
latitude of the venues to a data frame.

```{r 12}
ven_df <- con_ven$`_embedded`$venues

# subset relevant columns
ven_df <- subset(ven_df, select = c(name, city, postalCode, address, url, 
                                    location))

# transform to proper data.frame without nested dfs and rename long, lat
ven_df <- do.call(data.frame, ven_df) %>% rename("longitude" = "location.longitude",
                                                 "latitude" = "location.latitude")
# convert long, lat to numeric
ven_df <-  ven_df %>%
  mutate_at(c('longitude', 'latitude'), as.numeric)

glimpse(ven_df)
```